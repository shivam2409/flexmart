Type.registerNamespace("Common.App.AppsForOfficeCommon");Common.App.AppsForOfficeCommon.B=function(){};Common.App.AppsForOfficeCommon.o=function(){this.Ver=1};Common.App.AppsForOfficeCommon.i=function(n){this.b=n};Common.App.AppsForOfficeCommon.i.prototype={b:null,a:function(n,t,i){var r=new Common.App.AppsForOfficeCommon.o;r.Data=t;r.RR=i;r.CreatedOn=(new Date).getTime();this.b.a(n,Sys.Serialization.JavaScriptSerializer.serialize(r))}};Common.App.AppsForOfficeCommon.o.registerClass("Common.App.AppsForOfficeCommon.o");Type.registerNamespace("Common.App.OAuth");Common.App.OAuth.c=function(){};Common.App.OAuth.c.registerInterface("Common.App.OAuth.c");Common.App.OAuth.q=function(){};Common.App.OAuth.q.registerInterface("Common.App.OAuth.q");Common.App.OAuth.e=function(){};Common.App.OAuth.e.prototype={external:0,msa:1,aad:2};Common.App.OAuth.e.registerEnum("Common.App.OAuth.e",!0);Common.App.OAuth.h=function(){};Common.App.OAuth.g=function(){};Common.App.OAuth.g.registerInterface("Common.App.OAuth.g");Common.App.OAuth.i=function(n,t,i){this.q=n;this.i=i.a("OAuthManagerEnableConsoleLogging");this.m=i.a("IsO365ConsumerHost");this.l=i.a("IsO365CommercialHost");this.f=t;this.e=Common.App.OAuth.b.b();this.n=this.r(i.b("OAuthManagerHostPathOverride"));this.o=i.c("OAuthManagerPromiseTimeoutInMs",0);this.p=this.t(this.e);this.h=i.n("Microsoft.Office.SharedOnline.ClearCacheFixIsEnabled",!1);this.j=i.a("OAuthManagerEnableTimeout");this.g=i.c("OAuthManagerTimeoutInMs",0);this.k=i.a("ImplicitAuthMSALIsEnabled")};Common.App.OAuth.i.prototype={q:null,i:!1,h:!1,j:!1,k:!1,m:!1,l:!1,f:null,e:null,n:null,o:0,p:0,g:0,a:function(){return"LegacyOAuthManager "+this.f.a},b:function(){if(!this.u())return Diag.a.a(592328355,3e3,50,"SSO-based OAuth is not supported for non-O365 hosts"),Promise.resolve(!1);var n=this,t=this;return $$sc.h.toPromise$t(Boolean,this.f.e()).then(function(n){return Promise.resolve(n)}).catch(function(){return Promise.resolve(!1)})},u:function(){return Common.a.a.b("FileSource")==="WopiTest"?!0:this.l||this.m},d:function(n,t,i,r,u,f){var e=r?0:this.o,o=new Common.App.OAuth.i.a(n,t,this.e.authorityType,i,r,u,e,this.p,f,this.f.a);return o.j()},c:function(){var r=Common.App.OAuth.b.c(),n,t=(n=new Common.hb,n.appIds=this.s(this.e.authorityType),n.idp=r,n.authority=this.e.authority,n.redirectUri=this.n,n.upn=this.e.upn,n.enableConsoleLogging=this.i,n.enableClearCacheFix=this.h,n),i;return this.k&&(t.enableTimeout=this.j,this.g>0&&(t.timeout=this.g)),this.e.authorityType===2&&(t.tenantId=this.e.tenantId),Diag.a.a(578435091,3e3,50,"Calling WebAuthImplicitMsal.Load for {0} apps",t.appIds.length),i=Common.App.OAuth.d.a.Load(t,Common.a.k),Diag.a.a(595342371,3e3,100,"WebAuthImplicitMsal package loaded."),i.Telemetry&&Diag.a.a(595342370,3e3,50,JSON.stringify(i.Telemetry)),Promise.resolve(!0)},r:function(n){var u=window.location.protocol,f=window.location.host,t=n,i,r;return isNullOrUndefined(t)&&(i=window.location.pathname,r=i.lastIndexOf("/"),t=r>=0?i.substring(0,r+1):""),u+"//"+f+t+"WacOAuth.html"},t:function(n){return n.upn.indexOf("guest#")>-1?2:n.upn.indexOf("ext#")>-1?1:0},s:function(n){var u=[],t={},i,r,f;n===2?t=Common.a.bx:n===1&&(t=Common.a.by);i=t;for(r in i)f={key:r,value:i[r]},Array.add(u,f.value);return u}};Common.App.OAuth.i.a=function(n,t,i,r,u,f,e,o,s,h){this.a=n;this.g=t;this.h=i;this.i=r;this.b=u;this.l=f;this.f=e;this.m=++Common.App.OAuth.i.a.a;this.n=o;this.e=s;this.k=h};Common.App.OAuth.i.a.prototype={a:null,g:null,e:null,h:0,i:null,f:0,m:0,b:!1,l:null,c:0,d:0,n:0,k:null,s:function(){if(this.b&&this.e){var n=this;return new Promise(function(t){var i=new CommonUI.d;i.B(1);i.C(1,$a.m);i.c($a.m,n.e,0,function(n){n!==2&&n||t(!0);t(!1)})})}return Promise.resolve(!1)},r:function(){return this.a==="OfficeAddins"},j:function(){var t,i=Common.g.a(),n=this;return this.s().then(function(i){if(i){Diag.a.a(578435092,3e3,50,"User cancelled popup");var r;return Promise.resolve((r=new Common.cb,r.IsSuccess=!1,r.Token=null,r.ErrorCode="UserCancelled",r.ErrorMessage="User cancelled popup.",r))}return t=Common.App.OAuth.d.a.GetToken(n.i,n.g,Common.a.k,!1,n.b,n.r(),null).then(function(n){return n}),n.p(t).then(function(t){var i=n.o(t,!0);return i.IsSuccess?Diag.a.a(41460759,3e3,50,"Successfully retreived token for app [{0}]",n.a):Diag.a.a(41460760,3e3,15,"Failed to retrieve token for app [{0}]: {1}",n.a,JSON.stringify(i)),i},function(t){var i=n.o(t,!1);return(i.ErrorCode==="Timeout"||i.ErrorCode==="Token Renewal Failed"||i.ErrorCode==="token_renewal_error")&&n.c<2?(n.c+=1,Diag.a.a(42267907,3e3,50,"Retrying to retrieve token for app [{0}] attempt {1}: {2}",n.a,n.c,JSON.stringify(i)),n.j()):i.ErrorCode==="login_required"&&n.h===1&&n.d<=2&&Common.a.a.a("WordOAuthTestAppPopUpIsEnabled")?(n.d+=1,Diag.a.a(41460762,3e3,50,"Retrying retrieve token for app [{0}] with popup enabled, attempt {1}: {2}",n.a,n.d,JSON.stringify(i)),n.b=!0,n.j()):(Diag.a.a(41460764,3e3,15,"Failed to retrieve token for app [{0}]: {1}",n.a,JSON.stringify(i)),i)})})},o:function(n,t){var i=n,e=null,r=null,u=null,o=null,f;return i?i.ErrorCode||i.ErrorMessage?(r=i.ErrorCode?i.ErrorCode:"Exception",u=i.ErrorMessage?i.ErrorMessage:"No message"):i.Token?t?e=i.Token:(r="RejectToken",u="A rejected promise returned a token."):(r="Exception",u=JSON.stringify(n)):(r="NoResult",u="No result came from WebAuthJsImplictModule.GetToken()"),i&&i.Telemetry&&(o=i.Telemetry,Diag.a.a(595150290,3e3,50,JSON.stringify(o))),r==="token_renewal_error"&&(u="Token Renewal Error"),(r||u)&&(e=null),f=new Common.cb,f.IsSuccess=!!e,f.Token=e,f.ErrorCode=r,f.ErrorMessage=u,f.Telemetry=o,f},p:function(n){if(this.f<=0)return n;var t=0,i=this,r=this;return Promise.race([n,new Promise(function(n){t=window.setTimeout(function(){n(i.q())},i.f)})]).then(function(n){return window.clearTimeout(t),n})},q:function(){var n=new Common.hc;return n.ErrorCode="Timeout",n.ErrorMessage="The Implicit package did not resolve the promise",n}};Common.App.OAuth.j=function(n){this.e=n};Common.App.OAuth.j.prototype={e:null,b:function(){return Promise.resolve(!0)},c:function(){return Promise.resolve(!0)},d:function(){Diag.a.a(574239257,3e3,50,"Automation flag set.  Returning Mock Token.");var n;return Promise.resolve((n=new Common.cb,n.IsSuccess=!0,n.Token=this.e,n.ErrorCode="",n.ErrorMessage="",n))},a:function(){return"MockAuthTokenStrategy"}};Common.App.OAuth.b=function(){};Common.App.OAuth.b.b=function(){var n;return n=new Common.App.OAuth.h,n.upn=Common.a.a.b("UserPrincipalName")||"",n.authority=Common.a.a.b("OAuthManagerAuthority")||"https://login.microsoftonline.com/",n.authorityType=Common.App.OAuth.b.a(),n.tenantId=Common.a.a.b("TenantId")||"",n};Common.App.OAuth.b.a=function(){var n=0,t=Common.App.OAuth.b.c();return t.toLowerCase()==="aad"?n=2:t.toLowerCase()==="msa"&&(n=1),n};Common.App.OAuth.b.c=function(){return Common.a.a.b("HostAuthType")||""};Common.App.OAuth.a=function(n,t){this.h=!1;this.f=t?t:this.q(n);this.e=this.f?this.f.a():"None";Diag.a.a(42084323,3e3,50,"OAuthManager created with strategy {0}",this.e)};Common.App.OAuth.a.f=function(){return Common.a.a?Common.a.a.a("ImplicitAuthMSALIsEnabled"):!1};Common.App.OAuth.a.b=function(){return Common.a.a.a("UiHostSupportsAuthToken")};Common.App.OAuth.a.d=function(){return Common.a.a.b("OAuthManagerMockTokenForAutomation")};Common.App.OAuth.a.a=function(){return Common.a.a.c("OAuthManagerPromiseTimeoutInMs",0)};Common.App.OAuth.a.g=function(n){var i=Common.App.OAuth.b.a(),t=null;return i===2?t=Common.a.bx[n]:i===1&&(t=Common.a.by[n]),t};Common.App.OAuth.a.e=function(){var n=new Array(0);return Common.a.a.d("OAuthManagerDisabledBrowsers")&&((n=Common.a.a.g("OAuthManagerDisabledBrowsers"),n&&Common.c.p()&&Array.contains(n,"Electron"))||n&&Common.c.V()&&Array.contains(n,"Safari"))?!1:!0};Common.App.OAuth.a.prototype={f:null,e:"None",i:null,j:null,h:!1,g:!1,l:function(){return this.h||this.r(),this.g},q:function(n){var t,i;return(!Common.App.OAuth.a.d()||!Common.App.OAuth.a.d().length)?Common.App.OAuth.a.b()?new Common.App.OAuth.o:(t=Common.a.a.a("SharedAuthIsEnabled"),t)?Common.Utils.a.a().a(Common.App.OAuth.g,null):(i=new Common.App.OAuth.d(n,Common.App.OAuth.a.f()),new Common.App.OAuth.i(null,i,Common.a.a)):new Common.App.OAuth.j("OAuthManagerMockTokenForAutomation")},c:function(n){this.m(n)},m:function(n){if(this.i||(this.i=Common.App.OAuth.a.c.a(this.f.b(),!1,Common.App.OAuth.a.a())),!this.j){var t=this,i=this;this.j=this.i.then(function(i){return i?(Diag.a.a(42084353,3e3,50,"{0} initialized",t.e),Common.App.OAuth.a.c.a(t.f.c(Common.App.OAuth.b.b()),!1,Common.App.OAuth.a.a())):(Diag.a.a(42267908,3e3,10,"{0} failed to initialized for app [{1}], all future TryGetToken requests will fail.",t.e,n),Promise.resolve(!1))}).catch(function(){return Diag.a.a(574239256,3e3,10,"{0} failed to initialized for app [{1}], all future TryGetToken requests will fail.",i.e,n),Promise.resolve(!1)})}return this.j},a:function(n,t){return this.p(n,t,!1,null,"")},b:function(n,t,i,r){return this.p(n,t,!0,i,r)},p:function(n,t,i,r,u){var f,e,o,s;if(Diag.a.a(42084352,3e3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2}",n,t,this.e),!Common.a.a.a("OAuthManagerIsEnabled"))return this.k((f=new Common.cb,f.IsSuccess=!1,f.Token=null,f.ErrorCode="NotEnabled",f.ErrorMessage="OAuthManager is disabled.",f),n);if(e=Common.App.OAuth.a.g(n),isNullOrUndefined(e))return Diag.a.a(41961345,3e3,15,"Auth context not found. Ensure that your app [{0}] is listed in WacFrameImplicitAuthAADApplications or WacFrameImplicitAuthMSAV2Applications.",n),this.k((o=new Common.cb,o.IsSuccess=!1,o.Token=null,o.ErrorCode="DisallowedApp",o.ErrorMessage="Disallowed appName: "+n,o),n);if(!Common.App.OAuth.a.b()&&!Common.App.OAuth.a.e())return this.k((s=new Common.cb,s.IsSuccess=!1,s.Token=null,s.ErrorCode="NotEnabled",s.ErrorMessage="OAuthManager is disabled on the current browser",s),n);var c=Common.g.a(),l=this,a=this.m(e).then(function(f){return l.t(n,e,t,i,r,u,f)}),h,v=(h=new Common.cb,h.IsSuccess=!1,h.Token=null,h.ErrorCode="authTokenStrategy_timeout",h.ErrorMessage="Auth Strategy timed out when fetching token",h),y=i?0:Common.App.OAuth.a.a(),p=Common.App.OAuth.a.c.a(a,v,y),w=this,b=this;return p.then(function(t){return Promise.resolve(w.n(t,n,e,c))}).catch(function(){var t,i=(t=new Common.cb,t.IsSuccess=!1,t.Token=null,t.ErrorCode="authTokenStrategy_failure",t.ErrorMessage="Auth Strategy failed with an unknown error",t);return Promise.resolve(b.n(i,n,e,c))})},t:function(n,t,i,r,u,f,e){var o,s,h;return e?(s=this,h=this,this.f.d(n,t,i,r,u,f).then(function(n){return Promise.resolve(s.o(n,!0))}).catch(function(n){return Promise.resolve(h.o(n,!1))})):this.k((o=new Common.cb,o.IsSuccess=!1,o.Token=null,o.ErrorCode="InitFailed",o.ErrorMessage="Auth Strategy Failed to Init or Load",o),n)},n:function(n,t,i,r){var u={};return u.IsSuccess=n.IsSuccess,u.TokenAquired=!!n.Token&&n.Token!=="",u.ErrorCode=n.ErrorCode,t==="OfficeAddins"||(u.ErrorMessage=n.ErrorMessage),u.IsAnonymous=Common.a.a.a("IsAnonymousUser"),u.TimeInMS=Common.g.a()-r,u.AuthLibrary=this.e,u.ReplyUrlHost=window.location.host,u.AppName=t,u.AuthorityType=Common.App.OAuth.e.toString(Common.App.OAuth.b.a()),u.UserType=this.s(Common.App.OAuth.b.b()),u.IsAuthSupportedInSession=this.l(),u.AppId=i,Diag.a.a(593863640,3e3,50,JSON.stringify(u)),n},k:function(n,t){return Diag.a.a(578435090,3e3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",t,n.ErrorMessage),Promise.resolve(n)},s:function(n){return n.upn.indexOf("guest#")>-1?2:n.upn.indexOf("ext#")>-1?1:0},d:function(){return this.l()},r:function(){if(Common.a.a.b("FileSource")==="WopiTest")return this.g=!0,this.h=!0,this.g;var n=Common.a.a.a("IsAnonymousUser"),t=Common.a.a.a("IsO365ConsumerHost")||Common.a.a.a("IsO365CommercialHost");return this.g=!n&&t&&(Common.App.OAuth.a.b()||Common.App.OAuth.a.e()),this.h=!0,this.g},o:function(n,t){var i=n,e=null,r=null,u=null,o=null,f;return i?i.ErrorCode||i.ErrorMessage?(r=i.ErrorCode?i.ErrorCode:"Exception",u=i.ErrorMessage?i.ErrorMessage:"No message"):i.Token?t?e=i.Token:(r="RejectToken",u="A rejected promise returned a token."):(r="Exception",u=JSON.stringify(n)):(r="NoResult",u="No result came from WebAuthJsImplictModule.GetToken()"),!i||!i.Telemetry||!1||(o=i.Telemetry,Diag.a.a(579166408,3e3,50,JSON.stringify(o))),r==="token_renewal_error"&&(u="Token Renewal Error"),(r||u)&&(e=null),f=new Common.cb,f.IsSuccess=!!e,f.Token=e,f.ErrorCode=r,f.ErrorMessage=u,f.Telemetry=o,f}};Common.App.OAuth.a.c=function(){};Common.App.OAuth.a.c.a=function(n,t,i){if(!i)return n;var r=0;return Promise.race([n,new Promise(function(n){r=window.setTimeout(function(){n(t)},i)})]).then(function(n){return window.clearTimeout(r),Promise.resolve(n)}).catch(function(){return window.clearTimeout(r),Promise.resolve(t)})};Common.App.OAuth.m=function(){};Common.App.OAuth.m.a=function(){Common.App.a.a().a(new Common.App.OAuth.m,0,!1)};Common.App.OAuth.m.prototype={a:function(){return"Common.App.OAuth.OAuthPackage"},c:function(n){var i=this,t;n.b(Common.App.OAuth.g,null).a().b(function(){return new Common.App.OAuth.f(new Common.db(null,null,null))});t=this;n.b(Common.App.OAuth.c,null).a().b(function(){return new Common.App.OAuth.a(n.a(Common.fE,null),null)})},b:function(){Common.Utils.a.a().a(Common.App.OAuth.c,null).c(null)}};Common.App.OAuth.d=function(n,t){this.d=n;t?(this.b="webauth.implicit",this.a="BrowserAuth 1.20210112.6",this.c="BrowserAuth"):(this.b="webauth.implicit.msal",this.a="Implicit 2.20200811.2",this.c="Implicit")};Common.App.OAuth.d.prototype={a:"unset",d:null,b:null,c:null,e:function(){var t=Common.a.bJ(this.b,2),i=Common.a.bJ("es6-promise.auto",2),n;return window.self.WebAuthImplictScriptUrl=t,window.self.Es6PromisePolyfillJs=i,n=this,this.d.a(t).CWR(Boolean,function(){var i=window.self[n.c];return Common.App.OAuth.d.a=i,Common.App.OAuth.d.a?(Diag.a.a(41003229,3e3,100,"WebAuth package {0} loaded. Version: {1}",n.b,n.a),!0):(Diag.a.a(578435089,3e3,15,"Failed to resolve {0} for package {1} Version: {2}",t,n.b,n.a),!1)})}};Common.App.OAuth.o=function(){};Common.App.OAuth.o.prototype={e:null,b:function(){return this.e=Common.Utils.a.a().a(Common.App.WopiIdentity.d,null),Promise.resolve(!0)},f:function(n){for(var u,i=!1,f=n.toLocaleUpperCase(),r=["HTTPS:","API:"],e=r.length,t=0;t<e;++t)if(u=r[t],f.startsWith(u)){i=!0;break}return i||this.g(n)?n+"/.default":n},g:function(n){var t=new RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i");return t.test(n)},c:function(){return Promise.resolve(!0)},d:function(n,t,i,r){var u=this.f(i),f=new Common.App.WopiIdentity.f(i,u,!r,null,Common.a.k),e=this,o=this;return this.e.getAccessToken(f,t).then(function(n){var t;return t=new Common.cb,t.IsSuccess=!0,t.Token=n.get_accessToken(),t},function(n){var t;return t=new Common.cb,t.IsSuccess=!1,t.ErrorCode=n,t})},a:function(){return"ParentFrameTokenStrategy"}};Common.App.OAuth.p=function(){};Common.App.OAuth.p.prototype={a:null,c:null,b:0};Common.App.OAuth.f=function(n){this.k=Function.createDelegate(this,this.q);this.l=Function.createDelegate(this,this.r);this.m=Function.createDelegate(this,this.s);this.e=n;this.f=Common.a.a.b("SharedAuthOrigin");this.i=Common.a.a.b("SharedAuthFilePath")};Common.App.OAuth.f.prototype={h:null,f:null,i:null,e:null,g:null,a:function(){return"SharedAuthManager"},b:function(){if(this.h)return Promise.resolve(!0);if(!this.f)return Promise.reject(!1);this.g={};var t=this.j("loadFrame"),n=document.createElement("iframe");return n.style.cssText="height:0;width:0;display:none;",n.id="SharedAuthFrame",n.setAttribute("name","SharedAuthFrame"),n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-top-navigation"),n.src=this.f+this.i+"?replyUrl="+window.location.protocol+"//"+window.location.host,this.h=n,this.p(),document.body.appendChild(n),Diag.a.a(579166402,3e3,50,"SharedAuthManager Create: Frame Appended to Document"),t},c:function(n){var t=new Common.cB("SharedAuth_Init"),i;return t.Values=this.n(n),i=this.j("initFrame"),this.e.h(t,this.h.contentWindow,this.f),Diag.a.a(579166403,3e3,50,"SharedAuthManager Init: Called package initialize."),i},d:function(n,t,i,r,u,f){var e=new Common.cB("SharedAuth_TryGetToken"),o=this.o(),s;return e.Values=this.t(n,t,i,r,u,f,o),s=this.j(o),this.e.h(e,this.h.contentWindow,this.f),Diag.a.a(579166404,3e3,50,"SharedAuthManager TryGetToken: Called TryGetToken for app {0}",t),s},o:function(){return Common.y.a().a},t:function(n,t,i,r,u,f,e){var o={};return o.appName=n,o.appId=t,o.target=i,o.withPopup=r,o.claims=u,o.promptMessage=f,o.messageCorrelationId=e,o},p:function(){this.e.f(this.f);this.e.c("SharedAuth_ScriptLoaded");this.e.b("SharedAuth_ScriptLoaded",this.m);this.e.c("SharedAuth_ScriptInitialized");this.e.b("SharedAuth_ScriptInitialized",this.l);this.e.c("SharedAuth_GetTokenResponse");this.e.b("SharedAuth_GetTokenResponse",this.k)},j:function(n){var t=new Common.App.OAuth.p,r,i;return t.b=Common.g.a(),r=this,i=new Promise(function(n,i){t.a=n;t.c=i}),this.g[n]=t,i},s:function(n){var t=this.g.loadFrame,i=Common.g.a()-t.b;Diag.a.a(573940550,3e3,50,"SharedAuthManager OnScriptLoaded. E/T: [{0}]",i);t.a(Boolean.parse(n.Values.Success.toString()))},r:function(){var n=this.g.initFrame,t=Common.g.a()-n.b;Diag.a.a(573900506,3e3,50,"SharedAuthManager OnScriptInitialized. E/T: [{0}]",t);n.a(!0)},q:function(n){var t,i,r;if(!n.Values.messageCorrelationId||!n.Values.messageCorrelationId.toString()){Diag.a.a(573949510,3e3,10,"SharedAuthManager OnGetTokenResponse called without valid messageCorrelationId");return}if(t=this.g[n.Values.messageCorrelationId.toString()],!t){Diag.a.a(573949511,3e3,10,"SharedAuthManager OnGetTokenResponse called with an unregistered messageCorrelationId");return}i=Common.g.a()-t.b;Diag.a.a(573900507,3e3,50,"SharedAuthManager OnGetTokenResponse. E/T: [{0}]",i);r=!!n.Values.isSuccess&&Boolean.parse(n.Values.isSuccess.toString());r?t.a(n.Values.response):t.c(n.Values.response)},n:function(n){var t={};return t.upn=n.upn,t.authority=n.authority,t.authorityType=Common.App.OAuth.e.toString(n.authorityType),t.tenantId=n.tenantId,t.correlationId=Common.a.k,t.enableConsoleLogging=Common.App.OAuth.f.a,t}};Common.App.OAuth.a.registerClass("Common.App.OAuth.a",null,Common.App.OAuth.c);Common.App.OAuth.a.c.registerClass("Common.App.OAuth.a.c");Common.App.OAuth.p.registerClass("Common.App.OAuth.p");Common.App.OAuth.i.a.a=0;Common.App.OAuth.d.a=null;Common.App.OAuth.f.a=Common.a.a.a("OAuthManagerEnableConsoleLogging");Common.App.OAuth.m.a();Type.registerNamespace("Common.App.OAuth");Common.App.OAuth.k=function(){};Common.App.OAuth.k.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthCommercialTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.i(function(){var o=n.d.a(Common.App.OAuth.c,null),s=2e4,h=Common.a.a.b("LokiAADAppId")||"",c=Common.a.a.a("OAuthTestAppAllV2TokenRetrievalIsEnabled"),l=Common.a.bx,u=l,r,f,t,i;for(r in u){f={key:r,value:u[r]};t=f.key;switch(t){case"Loki":i=h;break;case"Maker":i="https://officescripting.microsoft.com";break;default:i="openid"}if(c||t==="Loki"){Diag.a.a(42084354,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}",t,i);var a=Common.g.a(),e=0,v=o.a(t,i).then(function(n){var i={};i.AppName=t;i.IsSuccess=n.IsSuccess;i.TokenAquired=!!n.Token&&n.Token!=="";i.ErrorCode=n.ErrorCode;i.ErrorMessage=n.ErrorMessage;i.IsAnonymous=Common.a.a.a("IsAnonymousUser");i.IsMSAL=!0;i.TimeInMS=Common.g.a()-a;i.ReplyUrlHost=window.location.host;Diag.a.a(41964885,3e3,50,JSON.stringify(i))}).catch(function(n){Diag.a.a(42084355,3e3,15,"[{0}]: {1}",t,JSON.stringify(n))});Promise.race([v,new Promise(function(){e=window.setTimeout(function(){var n={};n.AppName=t;n.ErrorCode="Timeout";n.ErrorMessage="Timed out waiting auth token promise";Diag.a.a(576070274,3e3,15,JSON.stringify(n))},s)})]).then(function(n){return window.clearTimeout(e),n})}}})}}};Common.App.OAuth.l=function(){};Common.App.OAuth.l.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthConsumerTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.i(function(){var o=n.d.a(Common.App.OAuth.c,null),s=Common.a.a.b("LokiMSAAppId")||"",h=Common.a.a.a("OAuthTestAppAllV2TokenRetrievalIsEnabled"),c=Common.a.by,r=c,t,e;for(t in r){var i={key:t,value:r[t]},u=i.key==="Loki",f=u?s:"openid";(h||u)&&(Diag.a.a(50431968,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}",i.key,f),e=Common.g.a(),o.a(i.key,f).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.IsAnonymous=Common.a.a.a("IsAnonymousUser");t.IsMSAL=!0;t.TimeInMS=Common.g.a()-e;t.ReplyUrlHost=window.location.host;Diag.a.a(50431969,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(50431970,3e3,15,JSON.stringify(n))}))}})}}};Common.App.OAuth.r=function(){};Common.App.OAuth.r.a=function(){Common.a.a.a("OAuthTestAppIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.n,0,!1);Common.a.a.a("OAuthTestAppAadTokenRetrievalIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.k,0,!1);Common.a.a.a("OAuthTestAppMsaTokenRetrievalIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.l,0,!1)};Common.App.OAuth.n=function(){};Common.App.OAuth.n.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.i(function(){var u=n.d.a(Common.App.OAuth.c,null),t=Common.a.dn,i=t.AppName,e=t.AuthorityType,f=t.TokenTarget,r;Diag.a.a(42084356,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}",i,JSON.stringify(t));r=Common.g.a();u.a(i,f).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.TimeInMS=Common.g.a()-r;Diag.a.a(41460766,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(42084357,3e3,15,JSON.stringify(n))})})}}};Common.App.OAuth.r.a();Type.registerNamespace("Common.App.LivePersonaUtils");Common.App.LivePersonaUtils.b=function(){};Common.App.LivePersonaUtils.b.a=function(){Common.App.a.a().a(new Common.App.LivePersonaUtils.b,0,!1)};Common.App.LivePersonaUtils.b.prototype={a:function(){return"Common.App.LivePersonaUtils"},b:function(){Common.Utils.a.a().a(Common.dV,null)},c:function(n){var t=this;n.b(Common.App.LivePersonaUtils.a,null).c(Common.dV,null).a().b(function(){return new Common.App.LivePersonaUtils.a(Common.Utils.b.a(Common.App.OAuth.c,n.c(Common.App.OAuth.c,null)))})}};Common.App.LivePersonaUtils.a=function(n){this.b=n};Common.App.LivePersonaUtils.a.prototype={b:null,a:function(){var i=this.d(),t,n;return i?(n=this,new Promise(function(t,r){n.b.CW(function(){if(n.b.b===4||n.b.b===5){r(Error.create("Error downloading auth library"));return}n.b.a().a("Loki",i).then(function(i){var f,r,u;return f=Common.a.a.a("ForceLokiFallbackToACLPTokenIsEnabled")?n.c():i.IsSuccess&&i.Token?(r=new Common.ed,r.isSuccess=!0,r.token=i.Token,r.errorMessage=null,r):Common.a.a.n("Microsoft.Office.SharedOnline.LokiUserDataSignatureTokenIsEnabled",!1)||Common.a.a.a("LokiUserDataSignatureTokenIsEnabled")?n.c():(u=new Common.ed,u.isSuccess=!1,u.token=null,u.errorMessage=JSON.stringify(i),u),t(f),f})})})):Promise.resolve((t=new Common.ed,t.isSuccess=!1,t.token=null,t.errorMessage=String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",Common.App.OAuth.b.c()),t))},c:function(){var t=Common.a.a.b("LokiUserDataSignature")||"",n;return n=new Common.ed,n.isSuccess=!0,n.token=t,n.errorMessage=null,n},d:function(){var n=null,t=Common.App.OAuth.b.a();return t===2?n=Common.a.a.b("LokiAADAppId"):t===1&&(n=Common.a.a.b("LokiMSAAppId")),n}};Common.App.LivePersonaUtils.a.registerClass("Common.App.LivePersonaUtils.a",null,Common.dV);Common.App.LivePersonaUtils.b.a();Type.registerNamespace("_Ewa");_Ewa.yr=function(n){_Ewa.yr.initializeBase(this);this.h=n;this.l()};_Ewa.yr.a=function(n){n.b().b(_Ewa.bfY.$$(_Ewa.im),350,new _Ewa.yr(n))};_Ewa.yr.prototype={h:null,b:function(){this.k(this.h.b().a(_Ewa.im,349,!1,null)||new _Ewa.OAuthManagerWrapper(Common.Utils.a.a().a(Common.App.OAuth.c,null)))}};_Ewa.OAuthManagerWrapper=function(n){this.c=n};_Ewa.OAuthManagerWrapper.prototype={c:null,a:function(n,t){var i,r;return this.c?(r=this,this.c.a(n,t).then(function(t){t.IsSuccess||Diag.a.a(51401292,0,15,"Error retrieving auth token. Message: "+t.ErrorMessage+" Error code: "+t.ErrorCode+" App name: "+n);var i;return i=new _Ewa.io,i.IsSuccess=t.IsSuccess,i.Token=t.Token,i.ErrorCode=t.ErrorCode,i.ErrorMessage=t.ErrorMessage,i})):(Diag.a.a(51401291,0,10,"Oauth manager is null"),Promise.resolve((i=new _Ewa.io,i.IsSuccess=!1,i.Token=null,i.ErrorCode="FailedToResolve",i.ErrorMessage="Failed to resolve IOAuthManager from the container.",i)))},b:function(){return this.c?this.c.d():null}};_Ewa.yr.registerClass("_Ewa.yr",_Ewa.rH.$$(_Ewa.im));_Ewa.OAuthManagerWrapper.registerClass("_Ewa.OAuthManagerWrapper",null,_Ewa.im);Type.registerNamespace("_Ewa");_Ewa.bhw=function(){};_Ewa.bhw.a=function(){_Ewa.k.a(function(n){_Ewa.yr.a(n)})};_Ewa.bhw.a();