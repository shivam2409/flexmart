Type.registerNamespace("Common.App.SafeLinks");Common.App.SafeLinks.b=function(n,t,i,r,u,f){this.IsSafeLinksEnabled=null;this.WebAffinitizedUrl=null;this.PolicyCookie=null;this.PolicyCookieTTL=0;this.WasServiceDown=!1;this.AffinitizedUrl=null;this.IsSafeLinksEnabled=n;this.WebAffinitizedUrl=t;this.PolicyCookie=i;this.PolicyCookieTTL=r;this.WasServiceDown=u;this.AffinitizedUrl=f};Common.App.SafeLinks.f=function(){this.url=null;this.verdict=0;this.navigateUrl=null;this.urlRepTTL=0;this.lookupStatusCode=0};Common.App.SafeLinks.e=function(){};Common.App.SafeLinks.SafeLinksManager=function(n,t,i,r,u,f){var s,e,a,h;if(this.w=Function.createDelegate(this,this.J),this.x=Function.createDelegate(this,this.K),Diag.a.a(26019598,378,100,"Initializing SafeLinksManager."),this.b=n,this.q=t,this.n=i,Common.App.SafeLinks.SafeLinksManager.b=f,this.k=r?this.b.b("SafeLinksHandlerWebServiceBase"):this.b.b("WebServiceBase"),this.r=this.b.b("SafeLinksHashedUserId"),this.v=this.b.b("SafeLinksWorkloadIdHeaderValue"),this.i=this.b.c("SafeLinksMaxGetPolicyBootRetries",2),this.j=this.b.c("SafeLinksMaxGetPolicyOnLinkClickRetries",1),this.g=this.O(),this.f=this.N(),Diag.a.a(26019599,378,50,"SafeLinksManager _isEnabledForUser={0}, _isEnabledForBrowser={1}",this.g,this.f),this.g&&this.f){var o=this.l(),c=o?o.IsSafeLinksEnabled.toLowerCase():"",l=this.u();Diag.a.a(36231312,378,50,"Cached values for IsSafeLinksEnabled: {0}, IsPolicyCookieExpired: {1}.",c,l);s=!o||c==="unknown"||o.WasServiceDown||l;e=this.t();e&&(e.set("shouldGetSafeLinksDataFromServer",s.toString()),e.set("isSafeLinksEnabledCacheValue",c.toString()));Common.o.a().recordKpiUsage("SafeLinksGetPolicy1",0,"jpittsdirects",e);a=this.b.d("LicensingForSafeLinksIsEnabled")?this.b.a("LicensingForSafeLinksIsEnabled"):!1;a&&u?(this.h=!1,h=this,u.a(function(n){n.a("MsoUrlreputation",!0).then(function(n){return h.h=n,h.h&&s&&h.s(!0),null})})):s&&this.s(!0)}};Common.App.SafeLinks.SafeLinksManager.d=function(n){return n.toLowerCase()!=="false"?!0:!1};Common.App.SafeLinks.SafeLinksManager.prototype={b:null,q:null,v:null,k:null,r:null,n:null,i:0,j:0,d:0,e:0,o:!1,m:!1,c:null,h:!0,g:!1,f:!1,p:null,E:function(){var t=this.k?this.k+"/":"",n=new Common.bu("SafeLinksHandler.ashx");return n.a("app",this.n),this.b.a("SafeLinksUseDebugHeader")&&n.a("action","debug"),String.format("{0}{1}&{2}",t,n.toString(),Common.a.i)},F:function(){var t=this.k?this.k+"/":"",n=new Common.bu("SafeLinksHandler.ashx");return n.a("app",this.n),this.b.a("SafeLinksUseDebugHeader")&&n.a("action","debug"),n.a("slrt","GetUrlReputation"),String.format("{0}{1}&{2}",t,n.toString(),Common.a.i)},G:function(){return Common.App.SafeLinks.SafeLinksManager.c||(Common.App.SafeLinks.SafeLinksManager.c=new Common.App.SafeLinks.SafeLinksNavigationHelper(this.b,this.q,this.F(),Common.App.SafeLinks.SafeLinksManager.b)),Common.App.SafeLinks.SafeLinksManager.c},a:function(n){var i,t,r,u,f;return n?(i=this.M(n),Diag.a.a(594830615,378,50,"SafeLinksManager.TryNavigate: isSupportedHyperLinkType={0},_isEnabledForUser={1},_isEnabledForBrowser={2},_isUserLicensedForSafeLinks={3}",i,this.g,this.f,this.h),!i||!this.g||!this.f||!this.h)?!1:(Common.o.a().recordKpiUsage("SafeLinksNavigations",0,"jpittsdirects",null),t=0,f=(u=this.P(r={val:t}),t=r.val,u),Diag.a.a(595079385,378,50,"ShouldTryUsingSafeLinksService returned NavigationState={0}",Common.App.SafeLinks.SafeLinksManager.a.toString(t)),!f)?(Common.o.a().recordKpiFailure("SafeLinksNavigations",Common.App.SafeLinks.SafeLinksManager.a.toString(t),t===1,!0,null),!1):(Diag.a.a(26019601,378,50,"Using safelinks to navigate hyperlink"),this.Q())?this.u()?!1:this.G().i(this.H(),n,this.y()):this.u()?(this.c=n,Diag.a.a(24462627,378,50,"Refreshing the cache as policy cookie expired."),this.m=!1,this.s(!1),!0):(this.C(n),!0):(Diag.a.a(593367827,378,10,"SafeLinksManager.TryNavigate: Null/Empty targetUrl"),!1)},M:function(n){var t,i;if(n=n.toLowerCase(),t=this.b.g("SafeLinksUnsupportedProtocols"),t)for(i=0;i<t.length;i++)if(n.startsWith(t[i]))return!1;return!0},s:function(n){var t=this.t(),i;t&&t.set("isOnBootRequest",n.toString());Common.o.a().recordKpiUsage("SafeLinksGetPolicySuccessfulRequest",1,"jpittsdirects",t);Common.o.a().recordKpiUsage("SafeLinksGetPolicyFailedRequest",0,"jpittsdirects",t);i=this.D("SafeLinksGetPolicy");this.q.a(this.E(),1,null,null,!0,2,this.x,this.w,i,null,!1,null,null,"23",null,!1,null,!1,null);this.m=n;this.o=!0;n?this.d++:this.e++},K:function(n){var u=406,i="",t,r,l,a,v;try{this.m=!1;this.o=!1;var o=n.b.f,s,h,c=(h=this.B(s={val:o}),o=s.val,h),f,y=(f=new Common.bl,f.durationMs=c,f);if(Common.o.a().recordKpiSuccess("SafeLinksGetPolicySuccessfulRequest",y),Diag.a.a(594830614,378,50,"GetSafeLinksDataFromServer_OnSuccessCallback: HttpStatus {0}, data length {1}, Duration {2}",n.b.a,n.b.b.length,c),n.b.a!==200){i="Unexpected httpStatus: "+n.b.a.toString();return}t=null;try{t=JSON.parse(n.b.b)}catch(p){i="Exception:"+p.toString()+" deserializing response";return}if(!t){i="Error when serializing response into SafeLinksData. SafeLinksData is null.";return}if(r=t.IsSafeLinksEnabled,isNullOrUndefined(r)||r.length<=0){i="Invalid isSafeLinksEnabledString";return}if(Diag.a.a(594830613,378,50,"Retrieved isSafeLinksEnabledString {0}",r),l=Common.App.SafeLinks.SafeLinksManager.d(r),isNullOrUndefined(t.WebAffinitizedUrl)||t.WebAffinitizedUrl.length<=0){i="Invalid WebAffinitizedUrl";return}if(isNullOrUndefined(t.PolicyCookie)||t.PolicyCookie.length<=0){i="Invalid PolicyCookie";return}if(isNullOrUndefined(t.PolicyCookieTTL)){i="Invalid PolicyCookieTTL";return}var w=t.WebAffinitizedUrl,b=t.PolicyCookie,k=t.AffinitizedUrl,e=new Date,d=t.PolicyCookieTTL>5?t.PolicyCookieTTL-5:0;e.setMinutes(e.getMinutes()+d);a=e.getTime();v=new Common.App.SafeLinks.b(r,w,b,a,!1,k);this.A(v);u=n.b.a;this.c&&(l?(this.C(this.c),this.d=0,this.e=0):(Diag.a.a(26019602,378,50,"SafeLinks is disabled by admin; Navigating without SafeLinks"),Common.o.a().recordKpiFailure("SafeLinksNavigations",Common.App.SafeLinks.SafeLinksManager.a.toString(1),!0,!0,null),Common.g.g(this.c)),this.c=null)}catch(g){i="GetSafeLinksDataFromServer_OnSuccessCallback: Exception:  "+g.toString()}finally{u!==200&&this.z(u,i)}},J:function(n){var t,i;this.o=!1;t=500;i="";try{var u=n.b.f,f,e,o=(e=this.B(f={val:u}),u=f.val,e),r,s=(r=new Common.bl,r.durationMs=o,r);t=n.b.a;Common.o.a().recordKpiFailure("SafeLinksGetPolicyFailedRequest","HttpStatusCode_"+t.toString(),!1,!0,s);i="Request Failed, Status="+Common.cc.toString(n.b.c)+" Duration: "+o}catch(h){i="GetSafeLinksDataFromServer_OnFailureCallback Exception: "+h.toString()}finally{this.z(t,i)}},z:function(n,t){var r,i,u,f;try{Diag.a.a(594830612,378,10,"HandleGetPolicyRequestError: HttpStatus {0}, Error {1}",n,t);this.d<this.i&&this.e<this.j?this.s(this.m):(this.m=!1,Diag.a.a(24462656,378,10,"Exhausted all retries for SafeLinks GetPolicy call. OnBootRetries: {0}, OnClickRetries: {1}, HttpStatus: {2}, Error: {3}",this.d,this.e,n,t),r=null,i=this.t(),i&&(i.set("HttpStatus",n.toString()),r=(u=new Common.bl,u.extendedProperties=i,u)),Common.o.a().recordKpiFailure("SafeLinksGetPolicy1","GetPolicyRequestError",!1,!0,r),f=new Common.App.SafeLinks.b("false","","",0,!0,""),this.A(f),this.c&&(Diag.a.a(26019603,378,50,"Error occurred during at-click GetPolicy call, NavigationState = {0}",Common.App.SafeLinks.SafeLinksManager.a.toString(2)),Common.o.a().recordKpiFailure("SafeLinksNavigations",Common.App.SafeLinks.SafeLinksManager.a.toString(2),!1,!0,null),Common.g.g(this.c),this.c=null))}catch(e){Diag.a.a(594830611,378,10,"HandleGetPolicyRequestError: Exception {0}",e.toString())}},C:function(n){var i=this.y(),r=this.L(),t={};t.Url=n;t.SafeLinksCookie=i;t.CorrelationId=Common.y.a().a;t.WorkloadId=this.v;t.UserAgentInfo=Common.c.D()+"|"+this.n;Diag.a.a(23900187,378,50,"Validating hyperlink with request correlation: {0}",t.CorrelationId);Common.g.s(Common.g.f(4),r,t)},O:function(){var n=this.b.b("IsSafeLinksEnabledForUser");return n?Common.App.SafeLinks.SafeLinksManager.d(n):!1},N:function(){var n=this.b.g("SafeLinksDisabledBrowsers"),t;if(Common.c.p()){if(this.b.d("SafeLinksForTeamsIsEnabled")&&this.b.a("SafeLinksForTeamsIsEnabled"))return!0;if(Array.contains(n,"Electron"))return!1}else if(Array.contains(n,Common.c.D()))return!1;return(t=(this.b.b("UiHost")||"").toLowerCase(),t==="officecomhwa")?!1:!0},Q:function(){var n=window.location.href.indexOf("&wd_slnh=1")!==-1;return n?!0:Common.c.p()},P:function(n){var t,i,r;return(n.val=0,t=this.l(),i=t?t.IsSafeLinksEnabled:"",i!=="")?t.WasServiceDown?(Diag.a.a(51663971,378,50,"Failed to retrieve policy data"),n.val=2,!1):i.toLowerCase()==="false"?(Diag.a.a(51664e3,378,50,"SafeLinks disabled for the user"),n.val=1,!1):Common.App.SafeLinks.SafeLinksManager.d(i):this.o?(n.val=3,Diag.a.a(595079384,378,50,"Currently getting SafeLinks policy"),!1):this.d>=this.i||this.e>=this.j?(n.val=2,Diag.a.a(51664001,378,50,"Exhausted all retries- Failure in GetPolicy for SafeLinks ({0}/{1} boot, {2}/{3} onClick)",this.d,this.i,this.e,this.j),!1):(r=this.d+this.e,Diag.a.a(23900182,378,10,"Inconsistent SafeLinks state: SafeLinks cache data is null with no on boot request pending, and {0} retries left over. Perhaps LocalStorage is inaccessable.",this.i+this.j-r),!0)},y:function(){var n=this.l();return n?n.PolicyCookie:""},L:function(){var n=this.l();return n?n.WebAffinitizedUrl:""},H:function(){var n=this.l();return n?n.AffinitizedUrl:""},I:function(){var t=new Date,n,i;try{n=this.l();i=n?n.PolicyCookieTTL:0;t.setTime(i)}catch(r){Diag.a.a(24462658,378,10,"Exception occured while fetching expiration time from cache: {0}",r)}return t},u:function(){var n=this.I();return!!n&&n.getTime()<Date.now()},l:function(){if(!this.p){var n=Common.Utils.c.a().c(this.r);if(!n||n==="")return null;this.p=JSON.parse(n)}return this.p},A:function(n){if(isNullOrUndefined(n))throw Error.argumentNull("safeLinksData");else if(isNullOrUndefined(n.IsSafeLinksEnabled)||n.IsSafeLinksEnabled.length<=0)throw Error.argumentNull("safeLinksData.IsSafeLinksEnabled");this.p=n;n.WasServiceDown||this.R(n)},R:function(n){var t=JSON.stringify(n);Common.Utils.c.a().a(this.r,t)},D:function(n){return isNullOrUndefined(Common.App.SafeLinks.SafeLinksManager.b)?null:Common.App.SafeLinks.SafeLinksManager.b.a("WebServiceCall",n)},B:function(n){if(!isNullOrUndefined(n.val)){var t=n.val.b();return n.val.a(),n.val=null,t}return null},t:function(){try{return new Map}catch(n){return null}}};Common.App.SafeLinks.SafeLinksManager.a=function(){};Common.App.SafeLinks.SafeLinksManager.a.prototype={enabledByPolicy:0,disabledByPolicy:1,disabled_GetPolicyFailure:2,disabled_PendingGetPolicyRequest:3};Common.App.SafeLinks.SafeLinksManager.a.registerEnum("Common.App.SafeLinks.SafeLinksManager.a",!1);Common.App.SafeLinks.SafeLinksNavigationHelper=function(n,t,i,r){this.c=Function.createDelegate(this,this.g);this.d=Function.createDelegate(this,this.h);this.e=n;this.a=t;this.b=i;Common.App.SafeLinks.SafeLinksNavigationHelper.a=r};Common.App.SafeLinks.SafeLinksNavigationHelper.prototype={e:null,a:null,b:null,i:function(n,t,i){var u,f,r,e;try{return u=null,Common.App.SafeLinks.SafeLinksNavigationHelper.a&&(u=Common.App.SafeLinks.SafeLinksNavigationHelper.a.a("WebServiceCall","SafeLinksGetUrlReputation")),f=new Common.App.SafeLinks.d(t,u),r={},r.AffinitizedUrl=n,r.TargetUrl=t,r.PolicyCookie=i,e=JSON.stringify(r),this.a.a(this.b,2,e,null,!1,2,this.d,this.c,f,null,!1,3e3,3e3,"36",null,!1,null,!1,null),!0}catch(o){Diag.a.a(588788033,378,10,o.message)}return!1},h:function(n){var r="OnGetUrlReputationSuccessCallback: ",u=10,i=n.b.f;try{var f=JSON.parse(n.b.b),t=f.reputationResults[0],e=t.navigateUrl.length,o=i.a.length,s=t.navigateUrl===i.a;t.navigateUrl&&t.navigateUrl.length>0&&(i.a=t.navigateUrl);r+=String.format("HttpStatus {0}, verdict {1}, clickedUrlLength = {2} navigateUrlLength {3}, navigateUrlSameAsClickedUrl {4}",n.b.a,t.verdict,o.toString(),e.toString(),s.toString());u=50}catch(h){r+=String.format("Exception {0}",h.message)}this.f(i,r,u)},g:function(n){var t="OnGetUrlReputationFailureCallback: ",i=n.b.f;try{t+=String.format("HttpStatus {0}",n.b.a)}catch(r){t+=String.format("Exception {0}",r.message)}this.f(i,t,10)},f:function(n,t,i){n.b&&(n.b.a(),n.b=null);Diag.a.a(588788034,378,i,t);Common.g.b(n.a,null,"noopener,noreferrer",!1,"SafeLinksNav")}};Common.App.SafeLinks.d=function(n,t){this.a=n;this.b=t};Common.App.SafeLinks.d.prototype={a:null,b:null};Common.App.SafeLinks.c=function(){};Common.App.SafeLinks.c.b=function(n){switch(n){case 3:return"Word";case 2:return"PowerPoint";case 1:return"Excel";default:return"Unknown"}};Common.App.SafeLinks.c.a=function(n){switch(n){case 1:return"Edit";case 2:return"View";case 3:return"InstantView";default:return"Unknown"}};Common.App.SafeLinks.b.registerClass("Common.App.SafeLinks.b");Common.App.SafeLinks.SafeLinksManager.registerClass("Common.App.SafeLinks.SafeLinksManager",null,Common.App.SafeLinks.a);Common.App.SafeLinks.SafeLinksNavigationHelper.registerClass("Common.App.SafeLinks.SafeLinksNavigationHelper");Common.App.SafeLinks.d.registerClass("Common.App.SafeLinks.d");Common.App.SafeLinks.SafeLinksManager.b=null;Common.App.SafeLinks.SafeLinksManager.c=null;Common.App.SafeLinks.SafeLinksNavigationHelper.a=null;Type.registerNamespace("_Ewa");_Ewa.zG=function(n){_Ewa.zG.initializeBase(this);this.h=n;this.l()};_Ewa.zG.a=function(n){n.b().b(_Ewa.bfY.$$(Common.App.SafeLinks.a),270,new _Ewa.zG(n))};_Ewa.zG.prototype={h:null,b:function(){this.k(this.h.b().a(Common.App.SafeLinks.a,269,!1,null)||new Common.App.SafeLinks.SafeLinksManager(Common.a.a,Common.a.d,String.format("{0}-{1}",Common.App.SafeLinks.c.b(Common.a.b().a().b()),Common.App.SafeLinks.c.a(Common.a.b().a().o())),!1,null,null))}};_Ewa.zG.registerClass("_Ewa.zG",_Ewa.rH.$$(Common.App.SafeLinks.a));Type.registerNamespace("_Ewa");_Ewa.biZ=function(){};_Ewa.biZ.a=function(){_Ewa.k.a(function(n){_Ewa.zG.a(n)})};_Ewa.biZ.a();